<!doctype html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Snapshot Sign Up</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link rel="stylesheet" href="/public/css/style.css">
</head>
<style>
    * {
        font-family: cursive;
    }

    @media screen and (max-width:500px) {
        .form {
            width: 100%;
        }
    }

    body {
        display: flex;
        justify-content: center;
        align-items: center;
        width: 100%;
        height: 100vh;
    }

    .input-error {
        border: 1px solid #ff4d4d !important;
        box-shadow: 0 0 8px rgba(255, 77, 77, 0.6);
        animation: inputShake 0.25s ease-in-out;
    }

    @keyframes inputShake {
        0% {
            transform: translateX(0);
        }

        25% {
            transform: translateX(-4px);
        }

        50% {
            transform: translateX(4px);
        }

        75% {
            transform: translateX(-4px);
        }

        100% {
            transform: translateX(0);
        }
    }

    .tost {
        position: fixed;
        top: 20px;
        right: 20px;
        transform: translateX(140%);
        transition: transform 0.3s ease-in-out;
        z-index: 9999999999999999999999999999999999999999;
    }

    .tost.active {
        transform: translateX(0);
    }
</style>

<body class="overflow-hidden">
    <div class="tost">
        <div class="flex flex-col w-72 text-xs z-50">
            <div class="succsess-alert flex items-center justify-between h-14 rounded-lg bg-zinc-300 px-3">
                <div class="flex gap-2">
                    <div class="text-[#2b9875] bg-zinc-200 p-1 rounded-lg tostSvg">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                            stroke="currentColor" class="w-6 h-6">
                            <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5"></path>
                        </svg>
                    </div>
                    <div>
                        <p class=" tostMess">done successfully</p>
                        <p class="text-zinc-600 tostMess">description here</p>
                    </div>
                </div>

                <button class="text-gray-400 hover:bg-white/10 p-1 rounded-md cutTost">
                    ‚ùå
                </button>
            </div>
        </div>
    </div>

    <div class="load invisible">
        <div class="loaer">
            <svg viewBox="0 0 80 80">
                <circle r="32" cy="40" cx="40" id="test"></circle>
            </svg>
        </div>

        <div class="loaer triangle">
            <svg viewBox="0 0 86 80">
                <polygon points="43 8 79 72 7 72"></polygon>
            </svg>
        </div>

        <div class="loaer">
            <svg viewBox="0 0 80 80">
                <rect height="64" width="64" y="8" x="8"></rect>
            </svg>
        </div>

    </div>

    <div class="flex gap-2 p-8 sm:flex-col sm:items-center overflow-hidden ">
        <div
            class="flex form flex-col sm:items-center sm:py-4 gap-6 p-4 border-1 border-solid border-white w-[100%] mx-auto items-center">
            <h1 class="text-4xl text-zinc-700">Snapshot
            </h1>
            <input type="text"
                class="p-2 bg-white border-1 fullname border-zinc-400 in border-solid outline-none w-70 text-xs border-solid rounded-sm bg-zinc-100"
                placeholder="Enter your Fullname" id="" required>
            <input type="text"
                class="p-2 bg-white border-1 username border-zinc-400 in border-solid outline-none w-70 text-xs border-solid rounded-sm bg-zinc-100"
                placeholder="Create your Username" id="" required>
            <input type="text"
                class="p-2 bg-white border-1 email border-zinc-400 in border-solid outline-none w-70 text-xs border-solid rounded-sm bg-zinc-100"
                placeholder="Enter your Email" id="" required>
            <input type="text"
                class="p-2 bg-white border-1 password border-zinc-400 in border-solid outline-none w-70 text-xs border-solid rounded-sm bg-zinc-100"
                placeholder="Create your Password" id="" required>
            <button
                class="bg-sky-500 rounded-lg p-1 submit text-white w-[100%] cursor-pointer border-solid border-1 text-sm border-white hover:bg-sky-700 ..."
                id="">Create Account</button>
        </div>
        <p class="text-black text-center text-sm">OR</p>
        <a href="login"
            class="flex flex-col a sm:items-center text-black btn text-sm  underline-1 hover:underline cursor-pointer">
            Login & already have an account
        </a>
    </div>

    <script>
        const load = document.querySelector('.load')
        let i = document.querySelectorAll('.in')
        let password = document.querySelector('.password')
        let email = document.querySelector('.email')
        let username = document.querySelector('.username')
        let fullname = document.querySelector('.fullname')
        let submit = document.querySelector('.submit')
        const tost = document.querySelector(".tost");
        const tostMess = document.querySelectorAll(".tostMess");
        const tostSvg = document.querySelector(".tostSvg");
        const cutTost = document.querySelector(".cutTost");
        let inputs = document.querySelectorAll('input')

        cutTost.addEventListener("click", () => tost.classList.remove("active"));

        submit.addEventListener("click", async () => {
            if (!validateForm()) return;

            submit.disabled = true;

            const response = await fetch("/auth/signup", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    fullname: fullname.value.trim(),
                    username: username.value.trim(),
                    email: email.value.trim(),
                    password: password.value
                })
            });

            const data = await response.json();
            showToast(data);

            if (data.success && data.redirect) {
                setTimeout(() => window.location.href = data.redirect, 600);
            }

            submit.disabled = false;
        });


        function showToast(data) {

            if (data.success) {
                tostSvg.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" fill="none"
                    viewBox="0 0 24 24" stroke-width="1.5"
                    stroke="#2b9875" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="m4.5 12.75 6 6 9-13.5"></path>
                </svg>`;
                tostMess[0].innerHTML = "Successfully Registered";
            } else {
                tostSvg.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" fill="none"
                    viewBox="0 0 24 24" stroke-width="1.5"
                    stroke="red" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M6 6l12 12M18 6L6 18"/>
                </svg>`;
                tostMess[0].innerHTML = "Something went wrong!";
            }

            tostMess[1].innerHTML = data.message || "";
            tost.classList.add("active");

            setTimeout(() => tost.classList.remove("active"), 3500);
        }

        function validateForm() {

            for (const input of inputs) {
                if (!input.value.trim()) {
                    showInputError(input);
                    showToast({ success: false, message: "Fill all required fields" });
                    return false;
                }
            }

            const emailVal = email.value.trim();
            const passVal = password.value;

            const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailPattern.test(emailVal)) {
                showInputError(email);
                showToast({ success: false, message: "Enter valid email" });
                return false;
            }

            if (passVal.length < 6) {
                showInputError(password);
                showToast({ success: false, message: "Password must be 6+ characters" });
                return false;
            }
            return true;
        }

        function showInputError(input) {
            input.classList.add("input-error");
            setTimeout(() => input.classList.remove("input-error"), 400);
        }

        inputs.forEach(inp => {
            inp.addEventListener("input", () => inp.classList.remove("input-error"));
        });

    </script>
</body>

</html>